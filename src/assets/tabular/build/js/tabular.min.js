!function(e){e.fn.tabularWidget=function(t){function i(e,t){if(e=e.origin,"object"==typeof e.clientValidation)for(var i in e.clientValidation)if(e.clientValidation.hasOwnProperty(i)&&"object"==typeof e.clientValidation[i]&&e.clientValidation[i].name===t)return e.clientValidation[i]}function a(e,t){var i=t.data("yiiActiveForm");if(void 0===i)return!1;if(void 0===i.attribute)return!1;for(var a in i.attributes)if(i.attributes.hasOwnProperty(a)&&i.aattributes[a].id===e)return!0;return!1}function r(t,a,r){var n=e(t?t:this),o=n.attr("name"),s=n.attr("data-origin-name"),d=e(a.$form).find("[data-repeater-list]").eq(0).data("repeater-list"),l=a.origin.additionalName?a.origin.additionalName:"",m=d+(l.length?"["+l+"][":"[")+r.toString()+"]["+s+"]",f="field-"+l.toLocaleLowerCase()+"-"+s.toLowerCase(),c=n.parent(),h="field-"+d.toLowerCase()+"-"+(l.length?l.toLowerCase()+"-":"")+r+"-"+s.toLowerCase(),u=i(a,s),p=h.replace("field-","");return{$this:n,$form:a.$form,name:o,originName:s,repeaterName:d,additional:l,inputName:m,_class:f,$parent:c,parentClass:h,validation:u,id:p}}var n,o=e.extend({selector:".repeater",deleteMessage:"Are you sure you want to delete this element?",minOverFlowMessage:"You cann't remove element. Minimal count is :min:",maxOverFlowMessage:"You cann't add element. Maximum count is :max:",messageShow:function(e,t,i){alert(e)},deletePrompt:function(e,t,i){return confirm(e)}},t),s=e.extend({initEmpty:!1,defaultValues:{"text-input":""},show:function(t,i,a,r,n,o){e(this).slideDown();var s=parseInt(e(this).attr("tabular-index")),l=d.repeaterOptions[s];e(this).find("has-error").removeClass("has-error"),e(this).find("help-block").empty(),l.lastIndex+=1,e(this).data("tabular-index",l.lastIndex);var m=d.renameInputs(l,e(this).find("input, textarea, select, checkbox"),l.$form.find("[data-repeater-item]").length-1);if("number"==typeof l.origin.max){if(l.$form.find(":has([data-repeater-list]):first").find("[data-repeater-item]").length>l.origin.max)return d.dropValidation(this,s,l,l.lastIndex),l.origin.messageShow(l.origin.maxOverFlowMessage.replace(":max:",l.origin.max),l,this),void e(this).remove()}d.addValidators(m)},hide:function(t){var i=e(this).attr("tabular-index"),a=e(this).data("tabular-index"),r=d.repeaterOptions[i];if(r.origin.deletePrompt(r.origin.deleteMessage,r,this)&&"number"==typeof r.origin.min){var n=r.$form.find(":has([data-repeater-list]):first").find("[data-repeater-item]").length;parseInt(r.origin.min)===n&&r.origin.messageShow(r.origin.minOverFlowMessage.replace(":min:",r.origin.min),r,this)}d.dropValidation(this,i,r,a),e(this).slideUp(t)},ready:function(t){this.$form.yiiActiveForm([],[]);var i=this;this.$form.find("[data-repeater-item]").each(function(t){e(this).attr("tabular-index",i.index),e(this).data("tabular-index",t),i.lastIndex=t,d.renameInputs(i,e(this).find("input, select, textarea, checkbox"),t)})},isFirstItemUndeletable:!0},o.repeaterOptions);this.addValidators=function(e){if("object"==typeof e&&e.length)for(var t in e)e.hasOwnProperty(t)&&s.$form.yiiActiveForm("add",e[t])},this.renameInputs=function(t,i,n){i=i||t.$form.find("input, textarea, select, checkbox"),n=n||0;var o=[];return i.each(function(){if(e(this).data("origin-name")){var i=r(this,t,n);i.$this.attr({name:i.inputName,id:i.id}),i.$parent.hasClass(i._class)&&i.$parent.removeClass(i._class),i.$parent.addClass(i.parentClass),i.validation&&!a(i.id,i.$form)&&(validation=i.validation||{},validation.id=i.id,validation.container="."+i.parentClass,validation.input="#"+i.id,o.push(validation))}}),o},this.dropValidation=function(t,i,a,n){$elements=e(t).find("input, textarea, select, checkbox"),i=i||0,$elements.each(function(){if(e(this).data("origin-name")){var t=r(this,a,n);a.$form.yiiActiveForm("remove",t.id)}})},this.getOption=function(e){return void 0!==o[e]?o[e]:null},this.setOption=function(e,t){void 0!==e&&(o[e]=t)},this.getRepeater=function(e){if(void 0!==d.repeatersd[e])return this.repeaters[e]},this.repeaters=[],this.repeaterOptions=[],this.$forms=e(o.selector);var d=this;clearAttributes=function(){var i=!1;return d.$forms.length&&d.$forms.each(function(a){n=e(this);var r=n.find("[data-repeater-item]");r.attr("tabular-index",a),s.$form=n,s.origin=o,s.index=a,r.length||(i=!0),r.each(function(a){$elements=e(this).find("input, textarea, select, checkbox"),a=a||0,$elements.each(function(){if(e(this).data("origin-name")){var r=n.data("yiiActiveForm");if(i="object"==typeof r){clearInterval(l);var s=e(this).data("origin-name");n.yiiActiveForm("remove",e(this).attr("id"));for(var d=0;d<5;d++)n.yiiActiveForm("remove",o.repeaterName.toLowerCase()+"-"+o.additionalName.toLowerCase()+"-"+a+"-"+s),n.yiiActiveForm("remove",o.additionalName.toLowerCase()+"-"+a+"-"+s),n.yiiActiveForm("remove",t.additionalName.toLowerCase()+"-"+s)}}}),d.addValidators(d.renameInputs(s,$elements,a))}),i&&(d.repeaters.push(n.repeater(s)),d.repeaterOptions.push(s))}),i};var l=setInterval(function(){clearAttributes()},30);return this}}(jQuery);